---
title: 光速入门浏览器插件
date: 2022/01/10 10:00:00
description:
categories: 技术
---
Chrome 插件目前有两个 Chrome API 版本，`V2` 以及 `V3`。

2021 年 1 月 20 日 Chrome 88 版本发布，商店开始支持上传 `Manifest V3` 插件，很长一段时间它们是共存的状态，渐渐地 `Manifest V2` 会阶段性地被弃用。

最近社区里面也出现了“劝人创业的声音”，也说明 Chrome V3 替换 V2 进程的加速。

![热门插件自然已升级到 mv3 了！](https://images.scar.site/img_v3_02di_68b05719-ca8d-41b4-bd05-aa51b587a6ag.jpg)

目前搜到的大多数入门文章是以 `Manifest V2` 为基础的，作为一名开发过多款浏览器插件的老前端，希望给社区分享一些插件开发的经验，让我们赶紧一起入门 `Manifest V3` 吧。

# 插件是什么？

浏览器插件是可以拓展浏览器功能的小应用，通过它用户可以自定义开发浏览器功能/行为/外观，常见的应用场景有：
- 开发工具：FeHelper(前端助手)、Eolink APIKit（API 测试）...
- 页面功能增强：AdBlock（去除页面广告） 、Saladict（翻译）
- 整合信息：搜索工具
- 娱乐与游戏
- 修改浏览器主题
- ...
# 插件、拓展、应用傻傻分不清楚
实际上我们常常说的浏览器插件，在浏览器直译为**浏览器拓展**。**插件**指的是另外的功能模块，
下面我们来看看区别～

## 拓展（Chrome Extension）
**扩展**（Extension），指的是通过调用 Chrome 提供的 Chrome API 来扩展浏览器功能的一种组件，**工作在浏览器层面**，使用 HTML、CSS、Javascript 等网页技术开发。


![https://chromewebstore.google.com/category/extensions?hl=en-US&utm_source=ext_sidebar](https://images.scar.site/image-20240813083817599.png)

## 插件（Chrome Plugins）
**插件**，指的是通过调用 Webkit 内核 NPAPI 来扩展内核功能的一种组件，**工作在内核层面**，理论上可以用任何一种生成本地二进制程序的语言开发，比如 C/C++、Delphi 等。

比如 Flash player 插件，就属于这种类型。一般在网页中用 \<object> 或者 \<embed> 标签声明的部分，就要靠插件来渲染。



## 应用（Chrome Apps）

> [Chrome Apps 弃用公告](https://blog.chromium.org/2020/08/changes-to-chrome-app-support-timeline.html)
Chrome Apps 允许你在 Chrome 上开发接近原生桌面的应用，开发方式和拓展类似。

因为 Google 提倡和推动**渐进式 Web Apps（Progressive Web Apps），即 PWA** 的概念，认为 PWA 是 Web 的未来，希望利用技术可以使 Web 实现接近原生 App 的体验，所以渐渐放弃支持 Web Apps。

根据公告，目前正在阶段性撤退，2022 年 6 月彻底弃用，Chrome Apps 将退出历史舞台（有点悲壮怎么回事）。
## 对照表
使用表格对比更清晰～
| 名称 |开发语言 |运行环境| 常见应用|
| --- | --- |--- |--- |
|拓展 Extension  |HTML、CSS、Javascript  | 浏览器|AdBlock|
|应用 App | HTML、CSS、Javascript |浏览器|Postman|
|插件 Plugins|任何一种生成本地二进制程序的语言，例如C、C++  |内核|Flash|

# 如何上线一款插件
开发一个平台应用我们需要**了解如何进行开发、调试、发布、联系官方等步骤**，Let's Go！
## 开发
无论开发什么平台的插件，往往都从入口文件的配置开始。

### manifest.json
`manifest.json`是 Chrome 拓展的入口文件，就像 *.html 是网页的入口文件，一般用于描述插件的基本信息。

最简单的 mainfest.json 如下：

```json
{
  "name": "Hello, World!",//插件名称
  "version": "1.0",//插件版本
  "manifest_version": 3,//Chrome API 版本
}
```
拖入后如图，三无产品，无图标、无介绍、无用。

TODO（录制个动图）

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/089ace84a0164453897aed8aa73ce3e4~tplv-k3u1fbpfcp-watermark.image?)
#### 加个图标和描述
装饰一下，加一个 16px 的中国红图标。
> 为什么是 16px？问咱就是一个浏览器规定。

`manifest.json` 中加入 action 字段：
```json
{
  "name": "Hello, World!",
  "version": "1.0",
  "manifest_version": 3,
  "action": {
    "default_title": "Hello, World by extension",//鼠标悬浮时显示 title
    "default_icon": "icon.png"//工具栏插件 icon
  }
}
```
鼠标悬浮在插件上，显示了标题，cool

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/81a24ceeeaca444e81f4babada51b5e1~tplv-k3u1fbpfcp-watermark.image?)

工具栏的图标是好看了，但是左边拓展页的图标还是很秃诶，所以我们继续加配置
```json
{
  "name": "Hello, World!",
  "version": "1.0",
  "manifest_version": 3,
  "action": {
    "default_title": "Hello, World by extension",
    "default_icon": "icons/icon12.png"
  },
  "icons": {
    "48": "icons/icon48.png",//48px 用于显示在 chrome://extensions
    "128": "icons/icon128.png"//128px 用于商店插件详情页
  }
}
```
128px 图标作用如图，在应用店的拓展详情页展示

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f38d7786ec0245d98f1b28dd67265f3b~tplv-k3u1fbpfcp-watermark.image?)
icons 的尺寸可以自己设置，浏览器会选一个最适合的尺寸显示。 
> 虽然官方这样说，但是我尝试过只指设置 12px，什么效果都没有，所以最好按推荐的尺寸（16、48、128）设置。

### 实现功能

前面提到过，插件使用 HTML、CSS、Javascript 语言进行开发，这部分基本上平时写前端项目没有区别；除此之外，插件还提供了 Chrome API 开放了一些额外的能力，比如拦截 API 请求、获取浏览器书签等信息。



**实现功能之前，首先要明确你想要实现什么功能？**，可以根据下面的图确定你要在插件哪块进行开发。

TODO 需要补一张图，说明不同的运行环境，每个功能找一个例子

- content_script:页面功能的增强
- popup：右上角的弹框
- background:背后默默执行的脚本
- option：独立的界面
- devtools：开发者工具加多一个 tab
- 主题

比如我需要实现一个

[Chrome 官方示例](https://github.com/GoogleChrome/chrome-extensions-samples)

## 测试/调试

### 载入插件
首先地址栏打开 chrome://extensions，点击右上角开关打开开发者模式 

![image.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8d8475b46c2a457f8e551d43af626826~tplv-k3u1fbpfcp-watermark.image?)

打开后拖入插件文件源文件包到浏览器，就可以开始愉快的调试了。
### 调试 content_script
注意：
* 通过 content_scripts 注入的 CSS 优先级几乎仅次于浏览器默认样式，
* 如果修改了 content_script，需要刷新插件作用界面代码才能生效 
### 调试 background
### 调试 popup
## 插件通信

除了 popup

#### 短链接

#### 长链接

#### 三方交互

### Chrome API

画图、讲清楚 API 所对应的权限

## 缓存

## 发布

### 注册 Chrome 应用商店开发者
要发布到 Google 应用商店的话，准备一张 VISA 卡，支付 5 美元的注册费成为开发者
### 公开范围
- 公开（商店可被搜索，可安装）
- 不公开 （商店不可被搜索，通过分享链接可安装）
- 私人 （指定网域或用户可下载）
### 审核时间
涉及权限变更的发布需要 7 天左右，权限没有变更的插件需要 1～2 天，请根据这个时间提前调整发布计划！
> 权限变更指的是 manifest.json 文件 permission 字段新增了权限
## 找也找不到的 Bug
如果自己实在找不到 Bug 出现的原因，可以
* [给 Google 提 bug](https://bugs.chromium.org/)
## 其他平台拓展开发

### Firefox

### Edge

https://docs.microsoft.com/zh-cn/microsoft-edge/extensions-chromium/developer-guide/port-chrome-extension
### Safafi

https://www.infoq.cn/article/tds104q68yk3olonlk9x
# 插件工程化

想要使用热门的框架，持续开发，可以使用工程话的



# 常见 Q&A

## 跨域

## background 内容策略

# 学习路径

师傅领进门修行靠个人，最好的学习资料当然是文档以及官方示例，我推荐的学习路线是：

* 看完这篇文章了解发布一款插件的概况
* 马上动手开发一个插件



提高技术水平就是不断地开发/写代码

# 总结

我想过很多种方式写入门文章，担心写着写着变成了文档，劝退大家。

十分感谢大家看到这里，如果还有想了解的内容，欢迎留言评论。

Chrome 插件对于前端开发者上手成本真心不高，平时做一些自用的小应用超级方便，但是中文文档相对较少，直接提高了开发难度。

其实这篇文章的我在 21 年就想写了，一直咕到今天。

![image-20240812085041696](https://images.scar.site/image-20240812085041696.png)

促使我重新捡起它的原因是我想找一篇给团队里新上手浏览器插件的同学，竟找不到一篇讲清楚概念，很快能上手的文章。

那只能自己打鸡血再放血写一篇了。



<div align=center>
<img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/251be3fa9c124c1890bf708de072081d~tplv-k3u1fbpfcp-watermark.image?">
</div>
Chrome 废弃的时间线一直在调整，这是三年前 timeline 的截图，本来预计是 2023 年 6 月废弃所有 MV2 插件

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8b7531c8660d4aacb153cde3830f7da9~tplv-k3u1fbpfcp-watermark.image?)

2024 年的今天

![r/firefox - Google is moving Manifest V2 support timeline (to June?)](https://i.redd.it/x0zeqwj6wqq91.png)

# 插件资料

* [仅20+行核心代码的Chrome插件](https://mp.weixin.qq.com/s?__biz=Mzg5MTU5ODYxOA%3D%3D&mid=2247489738&idx=1&sn=5bbd09e03bee8ec221c0371bcab01d35&chksm=cfcbbabff8bc33a9088b837df83759ac3f5b53d324f512d66b61bb5e13f2d89c34026b1ed5ca&mpshare=1&scene=1&srcid=1029j7mVFGtx6kBO05GnxlNB&sharer_sharetime=1635475813560&sharer_shareid=703dda51c230f59ac9e88b0f0dad80b0&version=3.1.18.90318&platform=mac#rd)
* [chrome插件入门及如何利用react进行开发](https://jishuin.proginn.com/p/763bfbd54785)
* [如何从零开始写一个 Chrome 扩展？](https://www.zhihu.com/question/20179805)
* [Chrome 拓展及开发应用](https://www.ituring.com.cn/book/miniarticle/110853?bookID=1421&type=minibook&subject=%E5%A3%B0%E3%80%80%E6%98%8E)
* [如何看待 Google 宣布将在主流平台上停止支持 Chrome 商店里的应用？](https://www.zhihu.com/question/49811598)
* [Chrome 的插件（Plugin）与扩展（Extension）有什么区别？](https://www.zhihu.com/question/20628768)
* [Chrome API 文档](https://developer.chrome.com/docs/extensions/reference/#stable_apis)
* [chrome插件入门及如何利用react进行开发](https://jishuin.proginn.com/p/763bfbd54785)
* [近万字新手 chrome 扩展开发简单入门](https://juejin.cn/post/6844904127932137485#heading-44)
* [Manifest V2 support timeline](https://developer.chrome.com/docs/extensions/develop/migrate/mv2-deprecation-timeline)